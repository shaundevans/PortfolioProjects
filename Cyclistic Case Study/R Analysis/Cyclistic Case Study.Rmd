---
title: "Cyclistic Case Study"
author: "Shaun Evans"
date: "5/11/2021"
output:
  pdf_document: default
  html_document: default
---

## Cyclistic Case Study

Cyclistic is a fictional bicycle company, seeking to focus on a strategy aimed as converting casual customers to members.  In order to determine how to implement this strategic goal, Cyclicistic has sought input on the following items: 

(1) How to annual members and casual riders use Cyclistic bikes differently? 
(2) WHy would casual riders buy Cyclistic annual memberships? 
(3) How can Cyclistic user digital media to influence casual riders to become members? 

Although Cyclistic is a fictional organization, the data used has been licensed for use by Motivate International, Inc. 

### Data Cleaning and Preparation in Excel

The data was first reviewed in Excel.  It was filtered and the following adjustments were made: 

(1) start_station_name, end_station_name
    (a) empty/null cells were filled with 'Unknown'

(2) start_station_id, end_station_id
    (a) empty/null cells were filled with 'NA' 
    (b) the locations below did not have a start_station_id or end_station_id
        -- W Oakdale Ave & N Broadway - station_id established: WOANB
        -- W Armitage Ave & N Sheffield Ave - station id established:WAANSA 
        -- N Clark St & W Elm St - station id established: NCSWES
        -- S Michigan Ave & E 118th St - station id established: SMAE118S
        

(3) empty start_lat, start_lng, end_lat, end_lng
    (a) these values were left as blank/null fields

(4) two new columns were added to each worksheet during the cleaning process
    (a) ride_length - a calculation of ride duration (=D1-C1)
        -- illogical values resulting from this calculation were left null
        
    (b) day_of_week - the day of the week the rental occurred (=WEEKDAY(C1,1))
    
### Data Insights in SQL 

During the Excel analysis phase, in addition to cleaning data, it was prepared to be uniform in title. As a result, although some tables had longer string lengths, these months were able to be successfully merged into a single view to prevent duplication of columns and improve the overall analysis of the data as whole. 

```{sql connection=}
create view all_data as 
	select * from may_20
	union all 
	select * from jun_20
	union all 
	select * from jul_20
	union all 
	select * from aug_20
	union all 
	select * from sep_20 
	union all
	select * from oct_20
	union all 
	select * from nov_20
	union all 
	select * from dec_20
	union all 
	select * from jan_21
	union all 
	select * from feb_21
	union all 
	select * from mar_21
```

After the view was created, the following queries were run to identify variations in behavioral patterns from members and casual riders: 

(1) Average ride length
(2) Type of rideable used during the course of the month(s)

```{sql connection=}
-- Average ride time casual 
select avg(ride_length) from all_data 
	where member_casual = 'casual'
	and ride_length > 0 
	
-- Average ride length member 
select avg(ride_length) from all_data 
	where member_casual = 'member'
	and ride_length > 0 
	
-- Type of used w/ month data - casual 
select rideable_type,
	   started_at,  
	   member_casual, 
	   day_of_week
	from all_data
	where ride_length > 0
	and member_casual = 'casual'; 

-- Type of used w/ month data - member
select rideable_type,
	   started_at,  
	   member_casual, 
	   day_of_week
	from all_data
	where ride_length > 0
	and member_casual = 'member'; 

```
```{sql connection=}

```

It was also indentified during the Excel sorting phase that certain ride length times were negative.  As a result, two queries to filter our ride_length behavior for positive length rides and negative length rides were designed. 

```{sql connection=}

-- trip data with valid ride durations 
select start_station_name,
	   start_station_id, 
	   end_station_name, 
	   end_station_id,
	   member_casual, 
	   ride_length,
	   day_of_week
	from all_data
	where ride_length > 0; 

-- trip data anomalies (ride length < 0)
select start_station_name,
	   start_station_id, 
       end_station_name, 
       end_station_id,
       member_casual,
       ride_length,
       day_of_week
	from all_data
	where ride_length < 0; 

```

In order to get a high-level insight on the data, the mean ride length for casuals, members, and combined were filtered. Additional insights were gleaned from SQL as well. 

```{sql connection=}

-- mean ride length for casuals
select avg(ride_length)
from all_data
where ride_length > 0 
and member_casual = 'casual'

-- mean ride length for members
select avg(ride_length)
from all_data
where ride_length > 0 
and member_casual = 'member'

-- mean ride length for all
select avg(ride_length)
from all_data
where ride_length > 0 
-- summary statistics 
select 'total members',
	count(member_casual) as findings
	from all_data
	where member_casual = 'member'
union 
select 'total casuals',
	count(member_casual) as casuals
	from all_data 
	where member_casual = 'casual'
union
select 'average ride length - casual',
	avg(ride_length) as average_ride_casuals
	from all_data 
	where member_casual = 'casual'
union 
select 'average ride length - members',
	avg(ride_length) as average_ride_members
	from all_data 
	where member_casual = 'member'
	and ride_length > 0 

-- day of week stats - member
select 'sunday',
	count(day_of_week) as count_of_rides_member,
	avg(ride_length) as average_ride_length_member
	from all_data 
	where member_casual = 'member'
	and ride_length > 0 
	and day_of_week = 1
union 
select 'monday', 
	count(day_of_week) as count_of_rides_member,
	avg(ride_length) as average_ride_length_member
	from all_data 
	where member_casual = 'member'
	and ride_length > 0 
	and day_of_week = 2
union 
select 'tuesday', 
	count(day_of_week) as count_of_rides_member,
	avg(ride_length) as average_ride_length_member
	from all_data 
	where member_casual = 'member'
	and ride_length > 0 
	and day_of_week = 3
union 
select 'wednesday', 
	count(day_of_week) as count_of_rides_member,
	avg(ride_length) as average_ride_length_member
	from all_data 
	where member_casual = 'member'
	and ride_length > 0 
	and day_of_week = 4
union 
select 'thursday', 
	count(day_of_week) as count_of_rides_member,
	avg(ride_length) as average_ride_length_member
	from all_data 
	where member_casual = 'member'
	and ride_length > 0 
	and day_of_week = 5
union 
select 'friday', 
	count(day_of_week) as count_of_rides_member,
	avg(ride_length) as average_ride_length_member
	from all_data 
	where member_casual = 'member'
	and ride_length > 0 
	and day_of_week = 6
union 
select 'saturday', 
	count(day_of_week) as count_of_rides_member,
	avg(ride_length) as average_ride_length_member
	from all_data 
	where member_casual = 'member'
	and ride_length > 0 
	and day_of_week = 7
	
-- day of week stats - casual
select 'sunday',
	count(day_of_week) as count_of_rides_casual,
	avg(ride_length) as average_ride_length_casual
	from all_data 
	where member_casual = 'casual'
	and ride_length > 0 
	and day_of_week = 1
union 
select 'monday', 
	count(day_of_week) as count_of_rides_casual,
	avg(ride_length) as average_ride_length_casual
	from all_data 
	where member_casual = 'casual'
	and ride_length > 0 
	and day_of_week = 2
union 
select 'tuesday', 
	count(day_of_week) as count_of_rides_casual,
	avg(ride_length) as average_ride_length_casual
	from all_data 
	where member_casual = 'casual'
	and ride_length > 0 
	and day_of_week = 3
union 
select 'wednesday', 
	count(day_of_week) as count_of_rides_casual,
	avg(ride_length) as average_ride_length_casual
	from all_data 
	where member_casual = 'casual'
	and ride_length > 0 
	and day_of_week = 4
union 
select 'thursday', 
	count(day_of_week) as count_of_rides_casual,
	avg(ride_length) as average_ride_length_casual
	from all_data 
	where member_casual = 'casual'
	and ride_length > 0 
	and day_of_week = 5
union 
select 'friday', 
	count(day_of_week) as count_of_rides_casual,
	avg(ride_length) as average_ride_length_casual
	from all_data 
	where member_casual = 'casual'
	and ride_length > 0 
	and day_of_week = 6
union 
select 'saturday', 
	count(day_of_week) as count_of_rides_casual,
	avg(ride_length) as average_ride_length_casual
	from all_data 
	where member_casual = 'casual'
	and ride_length > 0 
	and day_of_week = 7

```

After reviewing data in SQL, it was uploaded into R as individual .CSV files and merged into a single dataframe. Additionally, three summary .CSV files were also uploaded. 

```{r}
ad <- rbind(may_20_data_clean,
            june_20_data_clean,
            july_20_data_clean, 
            august_20_data_clean,
            september_20_data_clean,
            october_20_data_clean,
            november_20_data_clean,
            december_20_data_clean,
            january_21_data_clean,
            february_21_data_clean,
            march_21_data_clean)

summary(ad)

```

Next I run a summary on the stats exported directly from SQL for casual customers, followed by members. 


```{r}
summary(CasualRide.Stats)

```


```{r}
summary(Member.Ride.Stats)
```

There's a substantial different in the Mean ride time for customers and casuals.  On average, casual customers ride 2.57 times the duration of members -- slightly over an hour longer on average per transaction.  

```{r}
### using chron to create times from out decimal data in R
library(chron)
mean_c <- times(.02965 / 24 *60)
mean_m <- times(.01150 / 24 * 60)
diff_cm <- (mean_c - mean_m)
diff_pct <- (.02965/.01150)

### calling the mean casual, mean customer, and difference between the two
mean_c
mean_m
diff_cm
diff_pct


```

With a quick visualization, we can determine that the two days with the most total activity for members are Friday and Saturday.  However, Saturday and Sunday are the days with the greatest ride duration for members.  

```{r}
ggplot(Member.Ride.Stats) + geom_point(aes(x = X.column., y = count_of_rides_member, color = average_ride_length_member)) + labs(x = 'Day of Week', y = 'Member Rides', color = 'average ride length') + ggtitle('Use and Ride Length by Day - Member')
```

While there is some parity, the most used days from casual riders are Saturday and Sunday.  Sunday is the highest use day for ride duration for casuals, with Saturday being second in terms of aggregate use.  

It is note worthy to consider that while these dates are the highest in terms of duration, casual users--on average--consistently use the products longer than their member peers. 

```{r}
ggplot(CasualRide.Stats) + geom_point(aes(x = X.column., y = count_of_rides_casual, color = average_ride_length_casual)) + labs(x = 'Day of Week', y = 'Casual Rides', color = 'Avg Ride Length') + ggtitle('Use and Ride Length by Day - Casual')
```

While docked bikes make up the bulk, there is a clear lack of the same vigor with classic bikes and electric bikes amongst casual customers, when compared to members. 

```{r}
ggplot(ad) + geom_bar(aes(x = day_of_week, fill = member_casual)) + facet_grid(~rideable_type) + labs(x = 'Day of Week', y = 'Total Count', fill = 'User Status') + ggtitle('Usage by Day')
```



```{r}
ggplot(ad) + geom_bar(aes(x = rideable_type, fill = rideable_type)) + facet_grid(~member_casual) + labs(x = 'Bike Type', y = 'Transaction Count', fill = 'Rideable Type') + ggtitle('Type Usage by Membership Status')
```


```{r}
ggplot(subset(ad, rideable_type=='docked_bike')) + geom_bar(aes(x = day_of_week, fill = member_casual)) + facet_grid(~member_casual) + labs(x = 'Day of Week', y = 'Transaction Count', fill = 'Membership Status') + ggtitle('Docked Bike Usage by Membership Status')
```


```{r}
ggplot(subset(ad, rideable_type=='electric_bike')) + geom_bar(aes(x = day_of_week, fill = member_casual)) + facet_grid(~member_casual) + labs(x = 'Day of Week', y = 'Transaction Count', fill = 'Membership Status') + ggtitle('Electric Bike Usage by Membership Status')


```


```{r}
ggplot(subset(ad, rideable_type=='classic_bike')) + geom_bar(aes(x = day_of_week, fill = member_casual)) + facet_grid(~member_casual) + labs(x = 'Day of Week', y = 'Transaction Count', fill = 'Membership Status') + ggtitle('Classic Bike Usage by Membership Status')
```



### Findings and Recommendations

Based on the above findings, Casual user behavior varied from current members in the following ways: 

  (1) Average Ride Duration
  (2) Product Adoption
  (3) Peak Usage Behavior
  
Based on these varied behaviors, the following recommendations are being made: 

(1) Ride duration varied significantly.  Casual riders averages 2.57 times the ride duration of members.  It's possible that this is due to Cyclistic's cost-structure, which may incentivize this type of behavior (i.e. hourly payments) compared to a more steady, short-use type structure.  It is probable that the reason for the variation is due to the underlying usage reason--members are likely using Cyclistic's product for errands, while Casual users are using them for Leisure.  While this is outside the scope of this analysis, the marketing plan must examine cost-structure to ensure it is adequate to convert casual riders. 

(2) The marketing plan must focus on docked bikes as a primary priority.  Excluding classic bikes is advisable for this marketing plan, as they are a minute portion of ridership for casual riders. 

(3) Peak usage behavior was heavily skewed during weekends for casual riders.  This is also a sign of variation in underlying use behavioral drivers (i.e. leisure compared to commute).  Focusing on a leisure package will cater to converting casuals (i.e a 'weekender' membership, perhaps at a discounted price).  



